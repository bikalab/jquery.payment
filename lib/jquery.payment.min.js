(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define(["jquery"],function(n){var r,a,o,i,l,u,s,c,h,p,g,f,v,d,m,y,C,T,$,w,D,S,k;return n.payment={},n.payment.fn={},n.fn.payment=function(){var e,r;return r=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],n.payment.fn[r].apply(this,e)},i=/(\d{1,4})/g,n.payment.cards=o=[{type:"elo",patterns:[401178,401179,431274,438935,451416,457393,457631,457632,504175,506699,5067,509,627780,636297,636368,650,6516,6550],format:i,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:i,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:i,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:i,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:i,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:i,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:i,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:i,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:i,length:[16],cvcLength:[3],luhn:!0}],r=function(t){var e,n,r,a,i,l,u,s;for(t=(t+"").replace(/\D/g,""),a=0,l=o.length;l>a;a++)for(e=o[a],s=e.patterns,i=0,u=s.length;u>i;i++)if(r=s[i],n=r+"",t.substr(0,n.length)===n)return e},a=function(t){var e,n,r;for(n=0,r=o.length;r>n;n++)if(e=o[n],e.type===t)return e},f=function(t){var e,n,r,a,o,i;for(r=!0,a=0,n=(t+"").split("").reverse(),o=0,i=n.length;i>o;o++)e=n[o],e=parseInt(e,10),(r=!r)&&(e*=2),e>9&&(e-=9),a+=e;return a%10===0},g=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")?!0:null!=("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)?e.createRange:void 0)&&document.selection.createRange().text?!0:!1},S=function(t,e){var n,r,a,o,i,l;try{r=e.prop("selectionStart")}catch(u){o=u,r=null}return i=e.val(),e.val(t),null!==r&&e.is(":focus")?(r===i.length&&(r=t.length),i!==t&&(l=i.slice(r-1,+r+1||9e9),n=t.slice(r-1,+r+1||9e9),a=t[r],/\d/.test(a)&&l===""+a+" "&&n===" "+a&&(r+=1)),e.prop("selectionStart",r),e.prop("selectionEnd",r)):void 0},C=function(t){var e,n,r,a,o,i,l,u;for(null==t&&(t=""),r="０１２３４５６７８９",a="0123456789",i="",e=t.split(""),l=0,u=e.length;u>l;l++)n=e[l],o=r.indexOf(n),o>-1&&(n=a[o]),i+=n;return i},y=function(t){var e;return e=n(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=C(t),t=t.replace(/\D/g,""),S(t,e)})},d=function(t){var e;return e=n(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=C(t),t=n.payment.formatCardNumber(t),S(t,e)})},s=function(t){var e,a,o,i,l,u,s;return o=String.fromCharCode(t.which),!/^\d+$/.test(o)||(e=n(t.currentTarget),s=e.val(),a=r(s+o),i=(s.replace(/\D/g,"")+o).length,u=16,a&&(u=a.length[a.length.length-1]),i>=u||null!=e.prop("selectionStart")&&e.prop("selectionStart")!==s.length)?void 0:(l=a&&"amex"===a.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,l.test(s)?(t.preventDefault(),setTimeout(function(){return e.val(s+" "+o)})):l.test(s+o)?(t.preventDefault(),setTimeout(function(){return e.val(s+o+" ")})):void 0)},l=function(t){var e,r;return e=n(t.currentTarget),r=e.val(),8!==t.which||null!=e.prop("selectionStart")&&e.prop("selectionStart")!==r.length?void 0:/\d\s$/.test(r)?(t.preventDefault(),setTimeout(function(){return e.val(r.replace(/\d\s$/,""))})):/\s\d?$/.test(r)?(t.preventDefault(),setTimeout(function(){return e.val(r.replace(/\d$/,""))})):void 0},m=function(t){var e;return e=n(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=C(t),t=n.payment.formatExpiry(t),S(t,e)})},c=function(t){var e,r,a;return r=String.fromCharCode(t.which),/^\d+$/.test(r)?(e=n(t.currentTarget),a=e.val()+r,/^\d$/.test(a)&&"0"!==a&&"1"!==a?(t.preventDefault(),setTimeout(function(){return e.val("0"+a+" / ")})):/^\d\d$/.test(a)?(t.preventDefault(),setTimeout(function(){var t,n;return t=parseInt(a[0],10),n=parseInt(a[1],10),n>2&&0!==t?e.val("0"+t+" / "+n):e.val(""+a+" / ")})):void 0):void 0},h=function(t){var e,r,a;return r=String.fromCharCode(t.which),/^\d+$/.test(r)?(e=n(t.currentTarget),a=e.val(),/^\d\d$/.test(a)?e.val(""+a+" / "):void 0):void 0},p=function(t){var e,r,a;return a=String.fromCharCode(t.which),"/"===a||" "===a?(e=n(t.currentTarget),r=e.val(),/^\d$/.test(r)&&"0"!==r?e.val("0"+r+" / "):void 0):void 0},u=function(t){var e,r;return e=n(t.currentTarget),r=e.val(),8!==t.which||null!=e.prop("selectionStart")&&e.prop("selectionStart")!==r.length?void 0:/\d\s\/\s$/.test(r)?(t.preventDefault(),setTimeout(function(){return e.val(r.replace(/\d\s\/\s$/,""))})):void 0},v=function(t){var e;return e=n(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=C(t),t=t.replace(/\D/g,"").slice(0,4),S(t,e)})},D=function(t){var e;return t.metaKey||t.ctrlKey?!0:32===t.which?!1:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))},$=function(t){var e,a,o,i;return e=n(t.currentTarget),o=String.fromCharCode(t.which),/^\d+$/.test(o)&&!g(e)?(i=(e.val()+o).replace(/\D/g,""),a=r(i),a?i.length<=a.length[a.length.length-1]:i.length<=16):void 0},w=function(t){var e,r,a;return e=n(t.currentTarget),r=String.fromCharCode(t.which),/^\d+$/.test(r)&&!g(e)?(a=e.val()+r,a=a.replace(/\D/g,""),a.length>6?!1:void 0):void 0},T=function(t){var e,r,a;return e=n(t.currentTarget),r=String.fromCharCode(t.which),/^\d+$/.test(r)&&!g(e)?(a=e.val()+r,a.length<=4):void 0},k=function(t){var e,r,a,i,l;return e=n(t.currentTarget),l=e.val(),i=n.payment.cardType(l)||"unknown",e.hasClass(i)?void 0:(r=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)a=o[t],n.push(a.type);return n}(),e.removeClass("unknown"),e.removeClass(r.join(" ")),e.addClass(i),e.toggleClass("identified","unknown"!==i),e.trigger("payment.cardType",i))},n.payment.fn.formatCardCVC=function(){return this.on("keypress",D),this.on("keypress",T),this.on("paste",v),this.on("change",v),this.on("input",v),this},n.payment.fn.formatCardExpiry=function(){return this.on("keypress",D),this.on("keypress",w),this.on("keypress",c),this.on("keypress",p),this.on("keypress",h),this.on("keydown",u),this.on("change",m),this.on("input",m),this},n.payment.fn.formatCardNumber=function(){return this.on("keypress",D),this.on("keypress",$),this.on("keypress",s),this.on("keydown",l),this.on("keyup",k),this.on("paste",d),this.on("change",d),this.on("input",d),this.on("input",k),this},n.payment.fn.restrictNumeric=function(){return this.on("keypress",D),this.on("paste",y),this.on("change",y),this.on("input",y),this},n.payment.fn.cardExpiryVal=function(){return n.payment.cardExpiryVal(n(this).val())},n.payment.cardExpiryVal=function(t){var e,n,r,a;return a=t.split(/[\s\/]+/,2),e=a[0],r=a[1],2===(null!=r?r.length:void 0)&&/^\d+$/.test(r)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),r=n+r),e=parseInt(e,10),r=parseInt(r,10),{month:e,year:r}},n.payment.validateCardNumber=function(t){var n,a;return t=(t+"").replace(/\s+|-/g,""),/^\d+$/.test(t)?(n=r(t),n?(a=t.length,e.call(n.length,a)>=0&&(n.luhn===!1||f(t))):!1):!1},n.payment.validateCardExpiry=function(t,e){var r,a,o;return"object"==typeof t&&"month"in t&&(o=t,t=o.month,e=o.year),t&&e?(t=n.trim(t),e=n.trim(e),/^\d+$/.test(t)&&/^\d+$/.test(e)&&t>=1&&12>=t?(2===e.length&&(e=70>e?"20"+e:"19"+e),4!==e.length?!1:(a=new Date(e,t),r=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>r)):!1):!1},n.payment.validateCardCVC=function(t,r){var o,i;return t=n.trim(t),/^\d+$/.test(t)?(o=a(r),null!=o?(i=t.length,e.call(o.cvcLength,i)>=0):t.length>=3&&t.length<=4):!1},n.payment.cardType=function(t){var e;return t?(null!=(e=r(t))?e.type:void 0)||null:null},n.payment.formatCardNumber=function(t){var e,a,o,i;return t=t.replace(/\D/g,""),(e=r(t))?(o=e.length[e.length.length-1],t=t.slice(0,o),e.format.global?null!=(i=t.match(e.format))?i.join(" "):void 0:(a=e.format.exec(t),null!=a?(a.shift(),a=n.grep(a,function(t){return t}),a.join(" ")):void 0)):t},n.payment.formatExpiry=function(t){var e,n,r,a;return(n=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(e=n[1]||"",r=n[2]||"",a=n[3]||"",a.length>0?r=" / ":" /"===r?(e=e.substring(0,1),r=""):2===e.length||r.length>0?r=" / ":1===e.length&&"0"!==e&&"1"!==e&&(e="0"+e,r=" / "),e+r+a):""}})}).call(this);